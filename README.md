# **Инструкция по развертыванию проекта images-server**

Этот документ содержит пошаговые инструкции по развертыванию и запуску веб\-приложения images-server, которое позволяет загружать, просматривать и удалять изображения.

## **1\. Требования к окружению**

Для успешного развертывания проекта вам потребуется:

* **Python 3.8+**: Рекомендуется использовать последнюю стабильную версию Python 3 (для локального запуска без Docker).  
* **pip**: Менеджер пакетов Python, который обычно поставляется вместе с Python (для локального запуска без Docker).  
* **Git**: Для клонирования репозитория (если вы еще не скачали проект).  
* **Docker** и **Docker Compose**: Для контейнеризированного развертывания.

## **2\. Установка зависимостей**

Все необходимые библиотеки Python перечислены в файле requirements.txt.

### **Локальная установка (без Docker)**

1. **Клонируйте репозиторий** (если вы не скачали проект вручную):  
   git clone https://github.com/dmitryalexeevi4/images-server.git

2. **Создайте виртуальное окружение** (рекомендуется для изоляции зависимостей проекта):  
   python \-m venv venv

3. **Активируйте виртуальное окружение**:  
   * **Windows**:  
     .\\venv\\Scripts\\activate

   * **macOS/Linux**:  
     source venv/bin/activate

4. **Установите зависимости** из requirements.txt:  
   pip install \-r requirements.txt

## **3\. Структура проекта**

Проект images-server имеет следующую структуру:

images-server/  
├── app.py                  \# Основной файл приложения FastAPI  
├── Dockerfile              \# Инструкции для сборки Docker-образа  
├── docker-compose.yml      \# Конфигурация Docker Compose для запуска приложения  
├── requirements.txt        \# Список зависимостей Python  
├── logs/                   \# Директория для логов приложения (создается автоматически)  
│   └── app.log             \# Файл логов  
├── images/                 \# Директория для загруженных изображений (создается автоматически)  
├── templates/              \# Директория с HTML-шаблонами Jinja2  
│   ├── css/                \# CSS-файлы  
│   │   └── style.css       \# (Предполагается, что здесь будет CSS)  
│   ├── js/                 \# JavaScript-файлы  
│   │   └── script.js       \# (Предполагается, что здесь будет JS)  
│   ├── page\_pics/          \# Изображения, используемые на страницах  
│   │   ├── cat.png  
│   │   ├── bird.png  
│   │   └── dog.png  
│   ├── index.html          \# Шаблон главной страницы  
│   ├── upload.html         \# Шаблон страницы загрузки изображений  
│   └── images.html         \# Шаблон страницы галереи изображений  
└── utils/                  \# Вспомогательные утилиты  
    └── file\_utils.py       \# Утилиты для работы с файлами (например, генерация уникальных имен)

* **app.py**: Основной файл, содержащий логику FastAPI-приложения, определение маршрутов, обработку запросов и рендеринг шаблонов.  
* **Dockerfile**: Определяет, как создать Docker-образ для вашего приложения, включая базовый образ, копирование файлов, установку зависимостей и команду запуска.  
* **docker-compose.yml**: Файл конфигурации для Docker Compose, который описывает сервисы (в данном случае, ваше приложение), их зависимости, порты и монтируемые тома.  
* **requirements.txt**: Перечисляет все внешние библиотеки Python, необходимые для работы проекта.  
* **logs/**: Каталог для хранения логов приложения.  
* **images/**: Каталог, куда будут сохраняться все загруженные пользователями изображения.  
* **templates/**: Содержит все HTML-шаблоны, которые используются для отображения страниц. Подкаталоги css, js, page\_pics предназначены для статических файлов (стилей, скриптов, изображений для страниц).  
* **utils/file\_utils.py**: Содержит вспомогательные функции, такие как get\_unique\_name, которая используется для генерации уникальных имен файлов при загрузке.

## **4\. Запуск и остановка приложения**

### **Локальный запуск (без Docker)**

После установки всех зависимостей вы можете запустить приложение с помощью uvicorn:

1. **Убедитесь, что виртуальное окружение активировано.**  
2. **Запустите приложение**:  
   Можно использовать команду, указанную в app.py для запуска:python app.py  
Эта команда запустит Uvicorn с параметрами (host="127.0.0.1", port=8000, reload=True).

После запуска, приложение будет доступно по адресу: http://127.0.0.1:8000

### **Запуск с использованием Docker Compose**

1. **Убедитесь, что у вас установлен Docker и Docker Compose.**  
2. **Клонируйте репозиторий** (если вы не скачали проект вручную):  
   git clone https://github.com/dmitryalexeevi4/images-server.git
3. **Запустите приложение с помощью Docker Compose**:  
   docker compose up \--build

   * \--build: Пересобирает образы перед запуском, что полезно при изменении кода или зависимостей. Если вы не меняли код, можете использовать docker compose up для более быстрого запуска.

После запуска, приложение будет доступно по адресу: http://localhost:8000

### **Остановка**

* **Локальный запуск**: Для остановки приложения просто нажмите Ctrl+C в терминале, где запущен Uvicorn.  
* **Docker Compose**: Для остановки контейнеров, запущенных через Docker Compose, нажмите Ctrl+C в терминале, где запущен docker compose up. Чтобы остановить и удалить контейнеры, сети и тома, используйте:  
  docker compose down

## **5\. Описание маршрутов (Endpoints) и их функциональности**

Приложение images-server предоставляет следующие маршруты:

* **GET /**  
  * **Описание**: Главная страница приложения.  
  * **Функциональность**: Отображает приветственную страницу с случайно выбранным изображением из templates/page\_pics.  
  * **Шаблон**: index.html  
  * **Логирование**: Логирует "Открыта главная страница".  
* **GET /upload**  
  * **Описание**: Страница для загрузки новых изображений.  
  * **Функциональность**: Отображает форму для выбора и загрузки файла изображения.  
  * **Шаблон**: upload.html  
  * **Логирование**: Логирует "Открыта страница загрузки".  
* **POST /upload**  
  * **Описание**: Обрабатывает загрузку изображения.  
  * **Функциональность**:  
    * Принимает файл изображения.  
    * Проверяет тип файла (разрешены: JPEG, PNG, GIF).  
    * Проверяет размер файла (максимум 5 MB).  
    * Сохраняет файл в директорию images/ с уникальным именем.  
    * В случае успеха, отображает URL загруженного изображения.  
    * В случае ошибки (неверный тип/размер), отображает сообщение об ошибке на странице загрузки.  
  * **Шаблон**: upload.html (для отображения результата)  
  * **Логирование**: Логирует "Загрузка файла", а также ошибки сохранения или недопустимые файлы.  
* **GET /images**  
  * **Описание**: Галерея всех загруженных изображений.  
  * **Функциональность**: Отображает список всех изображений, находящихся в директории images/, с их именами и URL-адресами. Изображения отсортированы по имени.  
  * **Шаблон**: images.html  
  * **Логирование**: Логирует "Открыта галерея".  
* **DELETE /delete-image/{filename}**  
  * **Описание**: Удаление изображения по имени файла.  
  * **Функциональность**:  
    * Принимает имя файла изображения в качестве параметра пути.  
    * Проверяет существование файла и предотвращает удаление файлов вне директории images/.  
    * Удаляет указанный файл из директории images/.  
    * Возвращает JSON-сообщение об успешном удалении или ошибке.  
  * **Логирование**: Логирует успешное удаление или ошибки (файл не найден, недопустимый путь, ошибка удаления).  
* **Статические файлы**:  
  * GET /images/{filename}: Обслуживает загруженные изображения из директории images/.  
  * GET /templates/css/{filename}: Обслуживает CSS-файлы из templates/css/.  
  * GET /templates/page\_pics/{filename}: Обслуживает изображения для страниц из templates/page\_pics/.  
  * GET /templates/js/{filename}: Обслуживает JavaScript-файлы из templates/js/.